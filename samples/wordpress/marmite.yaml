description: A wordpress in a container (web and DB)

# an account on an OpenStack cloud providing Heat API.
environments:
  devtest:
# Implicite, heat is the default provider.
#    provider: heat
    identity:
#NOTE(Gonéri): Why the os_ prefix?
      os_auth_url: http://os-ci-test6.ring.enovance.com:5000/v2.0
      os_username: admin
      os_password: password
      os_tenant_name: demo
    medias:
      dump_mysql:
        type: dynamic
        sources:
          -
            type: script
            value: |
                #!/bin/sh
                cp $BASE_DIR/samples/wordpress/backup_wordpress.sql .
            target: mysql
    key_pairs:
      stack_os_ci-test7: |
        ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCyiXfE1zHKdj6odbysr917Cn88ov0VQaPJtLKJyMNuRYAeMOFQHd50X8JO4dfZbmSo3YdJlVfz9FLRxE64mqj9bkN8hPFbkTG2F1AWXGPON5cmm4uiLPfQkWhX/LnClrhzZpNtMJYs5AEFeDs0POijcRugZsQA+wvLi0lSlhOfkqtjAJKpPUwy1wrJFDdvqdQBjpNQh/LB8c15XfQV2JT/3NX26dQe8zvHhL6NvfhBnAikodYkBr7UjSl36CBk0cPebZMZEBBiHdo76xORVkpmqDvkhFByXXeAsvRa2YWS4wxpiNJFswlRhjubGau7LrT113WMcPvgYXHYHf2IYJWD goneri.lebouder@enovance.com
    floating_ips:
      public_wordpress_ip: 172.24.4.5

application:
  # Name of the application, Stack will be called according to this name
  name: wordpress

  # By convention, the heat file will be located here:
  # <root>/applications/<name e.g: wordpress>/heat.yaml

  medias:
    wordpress_files:
        type: dynamic
        sources:
          -
            type: git
            value: https://github.com/WordPress/WordPress
            target: wordpress
            ref: 3.8.2
    ubuntu-13.10-server-amd64.iso:
        type: block
        disk_format: iso
        copy_from: http://cl.releases.ubuntu.com/13.10/ubuntu-13.10-server-amd64.iso
        checksum: 4d1a8b720cdd14b76ed9410c63a00d0e
    base_image:
# Image generated with the following command:
# disk-image-create vm ubuntu heat-config os-collect-config os-refresh-config \
#   os-apply-config heat-config-cfn-init heat-config-puppet heat-config-script \
#   stackuser -o ubuntu-software-config.qcow2
# and the following patch https://review.openstack.org/#/c/91733/
        type: block
        disk_format: qcow2
        copy_from: http://nowhere/ubuntu-vm.qcow2
        checksum: e3224ba9d93b1df12db3b9e1d2f34ea7

testers:
    test_simple:
        driver: simple_check
        medias:
            base_image:
                type: block
                disk_format: qcow2
                copy_from: http://nowhere/ubuntu-vm.qcow2
                checksum: e3224ba9d93b1df12db3b9e1d2f34ea7
        # TODO(Gonéri):
        #   a key/value list would be more logicial here
        #   - _ALL_: ping -c5 $IP
        #   - my_first_http_host: httping $IP
        #   - etc
        params:
            _ALL_:
                ping -c5 $IP

    test_serverspec:
        driver: serverspec
        medias:
            serverspec_image:
                type: local
                path: samples/serverspec/serverspec_image.qcow2
            serverspec_datas:
                type: dynamic
                sources:
                  -
                    type: local
                    path: ~/serverspec
                    target: serverspec
        params:
            targets:
                - webserver_instance
