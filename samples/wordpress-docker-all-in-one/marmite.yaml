description: A wordpress in a container (web and DB)

# an account on an OpenStack cloud providing Heat API.
environments:
  devtest:
    # The nature of the env, for example here it is based on Heat+Docker
    provider: heat-devstack-docker
    provider_params:
      image: heat-devstack-docker
      flavor: m1.medium
      keypair: Nopasswd
      floating_ip: 46.231.128.152
    # Credentials required to connect to the OpenStack
    identity:
      os_username: $OS_USERNAME
      os_tenant_name: $OS_TENANT_NAME
      os_password: $OS_PASSWORD
      os_auth_url: $OS_AUTH_URL
    # A list of floating IP dedicated to the kitchen.
    # /!\ this list is associated with the OS_TENANT_NAME /!\
    ip_pool:
      - 10.0.0.4
      - 10.0.0.5
      - 10.0.0.6
  # Another environnement
  os-ci-test6:
# Implicite, heat is the default provider.
#    provider: heat
    identity:
      os_username: bob_l_eponge
      os_tenant_name: $OS_TENANT_NAME
      os_password: $OS_PASSWORD
      os_auth_url: $OS_AUTH_URL
    ip_pool:
      - 46.231.128.152
      - 46.231.128.153

application:
  # Name of the application, Stack will be called according to this name
  name: wordpress

  # By confention, the heat file will be located here:
  # <root>/applications/<name e.g: wordpress>/heat.yaml

  # Arguments for the heat command (-P), depending on the type, some value may be
  # generated:
  #  - floating_ip: get an IP from the pool depending on its position
  #  - keypair: retrieve a key content from a keys/<name>.pub
  #  - media: returns the image id of the media in Glance
  params:
    - { type: floating_ip, name: mysql_server,  idx: 0 }
    - { type: floating_ip, name: http_server,  idx: 1 }
    # the keypair(s) to use, keypair name is the filename without the extension,
    # e.g: keys/roberto.pub â†’ roberto
    - { type: keypair, name: roberto_key }
    - { type: value, name: blog_title, value: I'm sexy and I know it! }
    - { type: media, name: wp_files }
    - { type: media, name: sql_db_dump  }
  medias:
    # A image content computed before the Heat creation
    wp_files:
      type: git
      value: https://github.com/WordPress/WordPress
      # The directory in the image where to store the files
      target: ironic
      ref: 3.8.2
    sql_db_dump:
      type: script
      value: |
              #!/bin/sh
              mysqldump -hdbprod -utoto -ptoto wordpress > wordpress_prod.sql
      target: db
